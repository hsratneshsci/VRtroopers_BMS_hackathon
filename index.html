<?php
session_start();
if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['form_name']) && $_POST['form_name'] == 'loginform')
{
   $success_page = '';
   $error_page = basename(__FILE__);
   $database = './usersdb.php';
   $crypt_pass = md5($_POST['password']);
   $found = false;
   $db_email = '';
   $db_fullname = '';
   $db_username = '';
   $session_timeout = 600;
   if (filesize($database) > 0)
   {
      $items = file($database, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
      foreach ($items as $line)
      {
         list($username, $password, $email, $name, $active) = explode('|', trim($line));
         if ($username == $_POST['username'] && $active != "0" && $password == $crypt_pass)
         {
            $found = true;
            $db_email = $email;
            $db_fullname = $name;
            $db_username = $username;
            break;
         }
      }
   }
   if ($found == false)
   {
      header('Location: '.$error_page);
      exit;
   }
   else
   {
      $_SESSION['email'] = $db_email;
      $_SESSION['fullname'] = $db_fullname;
      $_SESSION['username'] = $db_username;
      $_SESSION['expires_by'] = time() + $session_timeout;
      $_SESSION['expires_timeout'] = $session_timeout;
      $rememberme = isset($_POST['rememberme']) ? true : false;
      if ($rememberme)
      {
         setcookie('username', $db_username, time() + 3600*24*30);
         setcookie('password', $_POST['password'], time() + 3600*24*30);
      }
      header('Location: '.$success_page);
      exit;
   }
}
$username = isset($_COOKIE['username']) ? $_COOKIE['username'] : '';
$password = isset($_COOKIE['password']) ? $_COOKIE['password'] : '';
if ((isset($_REQUEST['provider']) && $_REQUEST['provider'] == 'Google') || (isset($_REQUEST['hauth_done']) && $_REQUEST['hauth_done'] == 'Google'))
{
   require_once 'hybridauth/autoload.php';

   $error_page = '';
   $success_page = '';
   try
   {
      $config = ['callback' => Hybridauth\HttpClient\Util::getCurrentUrl() . '?hauth.done=Google',
                 'keys' => ['key' => '', 'secret' => '']
                ];
      $adapter = new Hybridauth\Provider\Google($config);
      $adapter->authenticate();
      $user_profile = $adapter->getUserProfile();
      $adapter->disconnect();
      $_SESSION['avatar'] = $user_profile->photoURL;
      $_SESSION['fullname'] = $user_profile->firstName.' '.$user_profile->lastName;
      $_SESSION['role'] = 'Member';
      $_SESSION['username'] = $user_profile->displayName;
      header('Location: '.$success_page);
   }
   catch(Exception $e)
   {
      header('Location: '.$error_page);
   }
   exit;
}
?>
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Untitled Page</title>
<meta name="generator" content="WYSIWYG Web Builder 17 - https://www.wysiwygwebbuilder.com">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="font-awesome.min.css" rel="stylesheet">
<link href="index.css" rel="stylesheet">
<script src="jquery-3.6.0.min.js"></script>
<script src="wb.panel.min.js"></script>
<script src="jquery-ui.min.js"></script>
<script src="wwb17.min.js"></script>
<script>
$(document).ready(function()
{
   $("#headerPanelMenu").panel({animate: true, animationDuration: 200, animationEasing: 'linear', dismissible: true, display: 'overlay', position: 'left', toggle: true});
   $("#headerPanelMenu_markup ul li a").click(function(event)
   {
       $.panel.hide($("#headerPanelMenu_panel"));
   });
});
</script>
<script>
$(document).ready(function()
{
   function waitForItUpdate()
   {
      // change the date here
      var dateFuture = new Date("September 04, 2022 17:00:00");
      var dateNow = new Date();
      var seconds = Math.floor((dateFuture - (dateNow))/1000);
      var minutes = Math.floor(seconds/60);
      var hours = Math.floor(minutes/60);
      var days = Math.floor(hours/24);

      hours = Math.round(hours-(days*24));
      minutes = Math.round(minutes-(days*24*60)-(hours*60));
      seconds = Math.round(seconds-(days*24*60*60)-(hours*60*60)-(minutes*60));
                                 
      $('#waitForItDays').html(days);
      $('#waitForItHours').html(hours);
      $('#waitForItMinutes').html(minutes);
      $('#waitForItSeconds').html(seconds);   
   }
   waitForItUpdate();
   setInterval(waitForItUpdate, 1000);
});
</script>
</head>
<body>

<div id="wb_header">
<div id="header">
<div class="row">
<div class="col-1">
<div id="wb_headerPanelMenu" style="display:inline-block;width:50px;height:53px;z-index:0;">
<a href="#headerPanelMenu_markup" id="headerPanelMenu">
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
</a>
<div id="headerPanelMenu_markup">
<ul role="menu">
   <li role="menuitem"><a href="#home" class="nav-link">Home</a></li>
   <li role="menuitem"><a href="#about" class="nav-link">About</a></li>
   <li role="menuitem"><a href="#projects" class="nav-link">Projects</a></li>
   <li role="menuitem"><a href="#contact" class="nav-link">Contact</a></li>
</ul>
<div id="headerPanelMenu-footer">Â© WYSIWYG Web Builder 2018</div>
</div>

</div>
</div>
<div class="col-2">
<div id="wb_headerBreadcrumb" style="display:inline-block;width:100%;z-index:1;vertical-align:top;">
<ul id="headerBreadcrumb">
<li><a href="#home">HOME</a></li>
<li><a href="#about">ABOUT</a></li>
<li><a href="#projects">PROJECTS</a></li>
<li><a href="#contact">CONTACT</a></li>
</ul>

</div>
</div>
<div class="col-3">
<input type="text" id="searchInput" style="display:none;width:185px;height:34px;z-index:2;" name="search" value="" spellcheck="false" placeholder="Search...">
<div id="wb_searchClose" style="display:none;width:33px;height:35px;text-align:center;z-index:3;">
<a href="#" onclick="ShowObjectWithEffect('searchInput', 0, 'slideright', 500);ShowObjectWithEffect('wb_searchClose', 0, 'fade', 1);ShowObjectWithEffect('wb_searchOpen', 1, 'fade', 1);return false;"><div id="searchClose"><i class="fa fa-times"></i></div></a>
</div>
<div id="wb_searchOpen" style="display:inline-block;width:33px;height:35px;text-align:center;z-index:4;">
<a href="#" onclick="ShowObjectWithEffect('searchInput', 1, 'slideright', 500);ShowObjectWithEffect('wb_searchClose', 1, 'fade', 1);ShowObjectWithEffect('wb_searchOpen', 0, 'fade', 1);return false;"><div id="searchOpen"><i class="searchOpen"></i></div></a>
</div>
<a id="Button1" href="./login.html" style="display:inline-block;width:95px;height:60px;z-index:5;">signup</a>
</div>
</div>
</div>
</div>
<div id="wb_LayoutGrid1">
<div id="LayoutGrid1">
<div class="row">
<div class="col-1">
<div id="wb_Text1">
<span style="color:#F5F5DC;font-family:Arial;font-size:16px;"><strong>platforms user registered</strong></span>
</div>
<div id="Html1" style="display:inline-block;width:100%;height:327px;z-index:7">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svidget="http://www.svidget.org/svidget" width="100%" height="100%" viewBox="0 0 400 400" style="background: transparent; color: white;" svidget:version="0.2.0">
	<title>Pie Chart</title>
	<desc>
		A simple pie chart. 
		This pie chart takes in an array of data elements and displays them as a pie chart.
		This widget was developed by Joe Agster for svidget.com and is licensed under the Creative Commons Attribution 4.0 License.
	</desc>

	<svidget:params>
		<!-- data params -->
		<svidget:param name="data" shortname="d" type="array" coerce="true" description="An array of name, value arrays. Example: [['Steelers', 0.14], ['Broncos', 0.38], ['Colts', 0.21], ['Raiders', 0.06]]. Note that the values do not need to sum to 1 or 100. The widget will auto sum the values to construct percentages." onset="handleDataParamSet"/>
		<svidget:param name="maxSlices" shortname="max" type="number" subtype="integer" defvalue="0" coerce="true" description="The max number of slices to allow. If there are more data for slices, the lowest valued slices will be grouped together as one slice. Default is unlimited." onset="handleDataParamSet"/>
		<svidget:param name="startAngle" shortname="angle" type="number" coerce="true" defvalue="0" description="The angle where the first slice will be located." onset="handleDataParamSet"/>
		<svidget:param name="sort" shortname="sort" type="bool" coerce="true" defvalue="0" description="Whether to sort the data. When true sorted by greatet to least value." onset="handleDataParamSet"/>
		<!-- style params -->
		<svidget:param name="colors" type="array" coerce="true" description="An array of colors that correspond to each pie slice. If there are more slices than colors then colors will be reused." onset="handleColorsParamSet"/>
		<svidget:param name="fontSize" shortname="fsize" type="number" coerce="true" defvalue="15" binding="#testtext@font-size" description="The font size for the labels." onset="handleDataParamSet"/>
		<svidget:param name="fontName" shortname="fname" type="string" defvalue="Helvetica" binding="#testtext@font-family" description="The font name for the labels." onset="handleDataParamSet"/>
		<svidget:param name="labelColor" shortname="lcolor" type="string" subtype="color" defvalue="white" description="The label color on the slices." onset="handleLabelParamsSet"/>
		<svidget:param name="labelType" shortname="lt" type="string" subtype="choice" typedata="percentage|value|text" coerce="true" defvalue="percentage" description="The label value to display. Values are 'percentage', 'value', or 'text'. Default is text." onset="handleDataParamSet"/>
		<svidget:param name="showLabels" shortname="sl" type="bool" coerce="true" defvalue="true" description="Whether to show the labels in the pie slices." onset="handleLabelParamsSet"/>
		<svidget:param name="showPopups" shortname="sp" type="bool" coerce="true" defvalue="true" description="Whether to show popups when hovering or clicking on pie slices." onset="handleShowPopupsParamSet"/>
	</svidget:params>

	<svidget:actions>
		<svidget:action name="animate" binding="animate" description="Animates the transition from 0-360 on the chart."/>
	</svidget:actions>

	<svidget:events>
		<svidget:event name="sliceSelect" description="Triggered when a slice is selected either by mousing over or touching (on non-mouse devices)."/>
		<svidget:event name="sliceActivate" description="Triggered when a slice is activated due to a click or touch after slice was selected."/>
	</svidget:events>

			
	<defs>
		<clipPath id="popupboxclip">
			<rect x="0" y="0" width="120" height="50" stroke-width="2"/>
		</clipPath>
	</defs>

	<g>
		<text id="footer" font-size="10" font-family="Helvetica" x="395" y="395" fill="#7f7f7f" text-anchor="end">
			<a xlink:href="http://www.svidget.com" class="footer"></a>.
		</text>
	</g>

	<g id="test" transform="translate(-1000 -1000)">
		<text id="testtext" font-size="15" font-family="Helvetica" x="0" y="0">udemy</text>
	</g>
	
	<g id="pie"><g tabindex="0" transform="matrix(1,0,0,1,0,0)" class=""><path d="M 200,10 A 190,190 0 0,1 298.72,37.66 L 200,200  Z" fill="#a411ee" stroke="#ffffff" style="stroke-width: 2; stroke-linejoin: round;"/><text x="244.08479240705776" y="46.40931524736958" fill="#ffffff" style="font-family: Helvetica; font-size: 15px; text-anchor: middle;">Hackerrank</text></g><g tabindex="1" transform="matrix(1,0,0,1,0,0)" class=""><path d="M 298.7209505067324,37.66031313616716 A 190,190 0 0,1 355.224,309.569 L 200,200  Z" fill="#00d9ff" stroke="#ffffff" style="stroke-width: 2; stroke-linejoin: round;"/><text x="341.3797422613274" y="174.37095171519968" fill="#ffffff" style="font-family: Helvetica; font-size: 15px; text-anchor: middle;"> Hackerearth</text></g><g tabindex="2" transform="matrix(1,0,0,1,0,0)" class=""><path d="M 355.224279671984,309.56926120182476 A 190,190 0 0,1 275.696,374.27 L 200,200  Z" fill="#5067ff" stroke="#ffffff" style="stroke-width: 2; stroke-linejoin: round;"/><text x="299.5225688202186" y="326.0796705440869" fill="#ffffff" style="font-family: Helvetica; font-size: 15px; text-anchor: middle;"> Codechef</text></g><g tabindex="3" transform="matrix(1,0,0,1,0,0)" class=""><path d="M 275.6962070707859,374.2701472860361 A 190,190 0 0,1 61.141,70.314 L 200,200  Z" fill="#0013c2" stroke="#ffffff" style="stroke-width: 2; stroke-linejoin: round;"/><text x="78.9250618558525" y="289.2140237374233" fill="#ffffff" style="font-family: Helvetica; font-size: 15px; text-anchor: middle;">Codeforces</text></g><g tabindex="4" transform="matrix(1,0,0,1,0,0)" class=""><path d="M 61.141166787156436,70.3149027884557 A 190,190 0 0,1 200,10 L 200,200  Z" fill="#00bd9e" stroke="#ffffff" style="stroke-width: 2; stroke-linejoin: round;"/><text x="132.6303757070005" y="48.64956891542793" fill="#ffffff" style="font-family: Helvetica; font-size: 15px; text-anchor: middle;">udemy</text></g></g>
	
	<g id="popupbox" clip-path="url(#popupboxclip)" transform="matrix(1,0,0,1,280,0)" display="none">
		<rect x="0" y="0" width="120" height="50" class="popupbox" stroke="#3f3f3f" stroke-width="2"/>
		<text id="popupboxlabel" font-family="Helvetica" font-size="15" fill="#000000" font-weight="bold" stroke="none" stroke-width="0" text-anchor="start" x="5" y="20"> Hackerearth</text>
		<text id="popupboxvalue" font-family="Helvetica" font-size="15" fill="#000000" stroke="none" stroke-width="0" text-anchor="start" x="5" y="40">26.1% (6)</text>
	</g>

	<script type="application/javascript" xlink:href="../scripts/svidget.min.js"/>
	<script type="application/javascript" xlink:href="../scripts/snap.svg-min.js"/>
	<script type="application/javascript" xml:lang="javascript">
		<![CDATA[

		// constants
		var DEFAULT_COLORS = ['#cf1f1f', '#1f1fcf', '#cf9f1f', '#1f9f1f', '#9f1f9f'];
		var EDGE = 10; // space between pie and edge
		var CENTER_SPACE = 0; // space between slice tip and center
		var SIZE = 400;
		var FULL_RADIUS = SIZE / 2;
		
		// param variables
		var _data = [];
		var _maxSlices = -1;
		var _startAngle = 0;
		var _sort = false;
		var _colors = DEFAULT_COLORS;
		var _fontSize = 15; //pixels
		var _fontName = 'Helvetica';
		var _labelColor = '#000';
		var _labelType = 'percentage';
		var _showLabels = true;
		var _showPopups = true;

		// general variables
		var _slices = null;
		var _activeSlice = null;
		var _loaded = false;
		var _runAnimation = true;
		
		
		/* Loading */
		
		// entry point
		function init() {
			//debugger;
			console.log('init');
			// for demo purposes only, in case no data is passes
			_data = [['banana', 4], ['apple', 6], ['cherry', 2], ['orange', 10], ['grape', 3.5]];
			initParams();
			initEvents();

			drawIfStandalone();
			_loaded = true;
		}
		
		function initParams() {
			loadParams();
		}
		
		function initEvents() {
			var surface = Snap(document.documentElement);
			surface.click(handleSurfaceClick);
			//var pie = Snap("#pie"); //Snap(document.documentElement); //"#pie");
			//pie.mouseout(handlePieOut);
			var widget = svidget.$;
			widget.onpagepopulate(handlePagePopulate);
		}
		
		function drawIfStandalone() {
			// this is temp hack to give chance for page to pass params, if no page then we are in standalone mode
			window.setTimeout(function () {
				if (svidget.$.populatedFromPage()) return;
				draw();
			}, 100);
		}
		
		window.addEventListener('load', init, false);
		
		
		/* Param Events */
		
		function loadParams() {
			var widget = svidget.$;
			_data = checkNull(widget.param("data").value(), _data);
			_maxSlices = checkNull(widget.param("maxSlices").value(), _maxSlices);
			_startAngle = checkNull(widget.param("startAngle").value(), _startAngle);
			_sort = checkNull(widget.param("sort").value(), _sort);
			_colors = checkNull(widget.param("colors").value(), _colors);
			_fontSize = checkNull(widget.param("fontSize").value(), _fontSize);
			_fontName = checkNull(widget.param("fontName").value(), _fontName); //'Arial';
			_labelColor = checkNull(widget.param("labelColor").value(), _labelColor); //'#000';
			_labelType = checkNull(widget.param("labelType").value(), _labelType); //'percentage';
			_showLabels = checkNull(widget.param("showLabels").value(), _showLabels);
			_showPopups = checkNull(widget.param("showPopups").value(), _showPopups);
		}
		
		// this handler is invoked once the params from page are passed to widget and populated onto params
		function handlePagePopulate(e) {
			loadParams();
			draw();
		}
		
		// this handler is invoked when these params are set: data, maxSlices, startAngle, sort, fontSize, fontName, labelType
		function handleDataParamSet(e) {
			if (!_loaded) return;
			//console.log('handleDataParamSet');
			var widget = svidget.$;
			if (widget.connected() && !widget.populatedFromPage()) return; // not all params have been populated, so defer until loadParams() is called
			//console.log('populated from page: ' + widget.populatedFromPage());

			_runAnimation = _runAnimation || e.target.name() == "data";
			loadParams();
			draw();
		}
		
		// this handler is invoked when the colors params is set
		function handleColorsParamSet(e) {
			if (!_loaded) return;
			//console.log('handleColorsParamSet');
			var widget = svidget.$;
			if (widget.connected() && !widget.populatedFromPage()) return; // not all params have been populated, so defer until loadParams() is called
			_colors = widget.param("colors").value();
			var i = 0;
			//debugger;
			iterateSliceContainers(function (snapEle) {
				var sliceEle = snapEle.select("path");
				var color = _colors[i];
				sliceEle.attr({ fill: color });
				i = (i + 1) % _colors.length;
			});
		}
		
		// this handler is invoked when the labelColor or showLabels params is set
		function handleLabelParamsSet(e) {
			if (!_loaded) return;
			//console.log('handleLabelParamsSet');
			var widget = svidget.$;
			if (widget.connected() && !widget.populatedFromPage()) return; // not all params have been populated, so defer until loadParams() is called
			_labelColor = widget.param("labelColor").value() || _labelColor;
			_showLabels = widget.param("showLabels").value();

			iterateSliceContainers(function (snapEle) {
				var labelEle = snapEle.select("text");
				labelEle.attr({
					fill: _labelColor,
					'font-family': _fontName,
					'font-size': _fontSize,
					'display': _showLabels ? "" : "none"
				});
			});
		}
		
		// this handler is invoked when the showPopups params is set
		function handleShowPopupsParamSet(e) {
			if (!_loaded) return;
			//console.log('handleShowPopupsParamSet');
			var widget = svidget.$;
			if (widget.connected() && !widget.populatedFromPage()) return; // not all params have been populated, so defer until loadParams() is called
			_showPopups = widget.param("showPopups").value();
			if (!_showPopups) hidePopup(); // just in case
		}
		
		
		/* Action Events */
		
		function animate(e) {
			_runAnimation = true;
			redraw();
		}
		
		
		/* UI Events */
		
		function handleSliceOver(e) {
			iterateSliceContainers(function (snapEle) {
				snapEle.removeClass("hover");
				snapEle.addClass("nonhover");
			});
			var target = Snap(e.currentTarget);
			target.removeClass("nonhover");
			target.addClass("hover");
			var index = target.data("index");
			//debugger;
			var currentSlice = _slices[index];
			if (_showPopups) showPopup(currentSlice);
			if (_activeSlice != currentSlice) e.preventDefault(); // in case of touchstart, prevents "click" from firing (needs test)
			_activeSlice = currentSlice;
			var val = toEventValue(currentSlice);
			svidget.$.event("sliceSelect").trigger(val);
			//console.log('handleSliceOver index=' + index);
		}
		
		function handleSliceOut(e) {
			iterateSliceContainers(function (snapEle) {
				snapEle.removeClass("hover");
				snapEle.removeClass("nonhover");
			});

			hidePopup();
			_activeSlice = null;
			//console.log('handleSliceOut');
			//console.log('handleSliceOut ' + e.target.nodeName + " " + e.target.id);
		}
		
		function handleSliceClick(e) {
			//alert('clicked');
			var target = Snap(e.currentTarget);
			var index = target.data("index");
			var currentSlice = _slices[index];
			var val = toEventValue(currentSlice);
			svidget.$.event("sliceActivate").trigger(val);
			e.stopPropagation();
		}
		
		function handleSurfaceClick(e) {
			handleSliceOut(e);
		}
		
		function toEventValue(slice) {
			return { name: slice.label, value: slice.value, ratio: slice.ratio };
		}
		
		
		/* Popup */
		
		function showPopup(slice) {
			document.getElementById("popupboxlabel").textContent = slice.label;
			document.getElementById("popupboxvalue").textContent = slice.toPctString() + " (" + slice.value + ")";
			var box = Snap("#popupbox");
			var rect = box.select("rect");
			//box.attr({ display: ""});
			positionBox(slice.centerAngle());
			setPopupVisible(true);
			
			function positionBox(angle) {
				var w = rect.node.width.baseVal.value;
				var h = rect.node.height.baseVal.value;
				var x = 0;
				var y = 0;
				angle = angle % 360;
				if (angle <= 90)
					x = SIZE - w;
				else if (angle <= 180) {
					x = SIZE - w;
					y = SIZE - h;
				}
				else if (angle <= 270)
					y = SIZE - h;
				box.transform(translate(x, y));
			}
			
			function translate(x, y) {
				return "translate(" + x + " " + y + ")";
			}
		}
		
		function hidePopup() {
			setPopupVisible(false);
		}
		
		function setPopupVisible(visible) {
			var d = visible ? "" : "none";
			document.getElementById("popupbox").setAttribute("display", d);
		}
		
		
		/* Drawing */

		function draw() {
			//debugger;
			clearPie();
			loadSlices();
			drawSlices();
			_runAnimation = false;
		}
		
		function redraw() {
			clearPie();
			drawSlices();
			_runAnimation = false;
		}
		
		function clearPie() {
			var pie = Snap("#pie");
			pie.clear();
		}
		
		function loadSlices() {
			_slices = buildSlices(_data);
		}
		
		function drawSlices() {
			if (!_slices || !_slices.length) return; // no data yet
			for (var i=0; i<_slices.length; i++) {
				var slice = _slices[i];
				drawSlice(slice);
			}
		}
		
		function drawSlice(slice) { //startAngle, endAngle, color) {
			var pie = Snap("#pie");
			var sliceContainer = pie.group();
			// wire events
			sliceContainer.data("index", slice.index);
			sliceContainer.mouseover(handleSliceOver);
			sliceContainer.touchstart(handleSliceOver); // for touch devices
			sliceContainer.mouseout(handleSliceOut);
			sliceContainer.click(handleSliceClick);
			
			sliceContainer.attr({ 'tabindex': slice.index });
			// set up animation
			//var r = "r-" + slice.angle + ",200,200";
			//sliceContainer.transform("r-180,200,200");
			if (_runAnimation) {
				animateSlices(sliceContainer, slice);
			}
			// build sub-elements for slice
			var sliceEle = buildSliceElement(sliceContainer, slice.path, slice.color); //g, startAngle, endAngle, color);
			var labelEle = buildLabelElement(sliceContainer, slice.getLabelString(), slice.textcolor, slice.textX, slice.textY);
		}
		
		function buildSliceElement(container, path, color) { //, source, startAngle, endAngle, color) {
			//var d = generateSlicePath(startAngle, endAngle);
			var sliceEle = container.path(path);
			sliceEle.attr({
				fill: color,
				stroke: "#fff",
				strokeWidth: 2,
				'stroke-linejoin': 'round'
			});
			return sliceEle;
		}
		
		function buildLabelElement(container, text, color, x, y) {
			if (x < 0 || y < 0) return; // there is no room for label, so exit
			var yOffset = _fontSize / 4.0; // this is for positioning text along baseline
			var labelEle = container.text(x, y, text);
			labelEle.attr({
				fill: color,
				x: x,
				y: y + yOffset,
				'font-family': _fontName,
				'font-size': _fontSize,
				'text-anchor': 'middle',
				'display': _showLabels ? "" : "none"
			});
			return labelEle;
		}
		
		function iterateSliceContainers(action) {
			var pie = Snap("#pie");
			var groups = pie.selectAll("g");
			for (var i=0; i<groups.length; i++) action(groups[i]);
		}
		
		function animateSlices(sliceContainer, slice) {
			sliceContainer.transform("rotate(-" + parseInt(slice.angle) + " 200 200)");
			sliceContainer.animate({ transform: "rotate(0 200 200)" }, 500, mina.easein);
		}
		
		
		/* Slice Building */
		
		function buildSlices(data) {
			if (!data || !data.length) return;
			// ex: [['Steelers', 0.14], ['Broncos', 0.38]]
			data = data.slice(); // clone array
			var slices = [];
			var sum = 0.0;
			var remSlice = { name: "Other", value: 0 };
			// sort by value so that smaller slices are grouped together
			if (_sort) sortData(data);
			
			// builds a collection of slice items to be use to build the actual slice objects below
			// also sums the total of all values for each item
			for (var i=0; i<data.length; i++) {
				var item = data[i];
				
				if (item.length && item.length >= 2) {
					if (_maxSlices > 0 && i >= _maxSlices-1 && data.length > _maxSlices) {
						remSlice.value += item[1];
					}
					else {
						var slice = { name: item[0], value: item[1] };
						slices.push(slice);
					}
					sum += +item[1];
				}
			}
			// append remaining slice if maxSlices exceeded
			if (remSlice.value > 0) slices.push(remSlice);
			
			// calc ratios
			for (var i=0; i<slices.length; i++) {
				slices[i].ratio = slices[i].value / sum;
			}
			
			// build slice objects
			var result = [];
			var startAngle = _startAngle;
			for (var i=0; i<slices.length; i++) {
				var colorIndex = i % _colors.length;
				var item = new Slice(startAngle, slices[i].ratio, _colors[colorIndex], slices[i].value, slices[i].name, _labelColor, i);
				var angleLength = item.ratio * 360;
				result.push(item);
				startAngle += angleLength;
			}
			
			return result;
		}

		function sortData(data) {
			data.sort(function (a,b) {
				return b[1] - a[1]; //sort descending by value (index 1 in subarray)
			});
		}
		
		
		/* Misc */
		
		function checkNull(item, backupItem) {
			return item != null ? item : backupItem;
		}


		/* Models */

		// Slice object
		function Slice(angle, ratio, color, value, label, labelColor, index) {
			this.angle = angle;
			this.ratio = ratio;
			this.angleLength = ratio * 360;
			this.color = color;
			this.textcolor = labelColor;
			this.value = value;
			this.label = label;
			this.index = index;
			this.path = generateSlicePath(angle, angle + this.angleLength);
			this.textX = -1;
			this.textY = -1;
			
			//console.log('new Slice populateTextXY');
			populateTextXY.call(this);
			//console.log('new Slice populateTextXY complete');
			
			function populateTextXY() {
				//debugger;
				var textRect = getTextRectXY(this.angle, this.angleLength, this.path, this.getLabelString());
				if (textRect == null) return;
				var textX = textRect.x + (textRect.width / 2);
				var textY = textRect.y + (textRect.height / 2);
				this.textX = textX;
				this.textY = textY;
			}
			
			// returns { x: 0, y: 0, width: 0, height: 0 }
			function getTextRectXY(angle, angleLen, path, label) {
				// measure text length and height, this is the text bounding rect
				var PAD = 6;
				//var YOFFSET = 4;
				var textEle = document.getElementById("testtext");
				textEle.textContent = label;
				var rectWidth = textEle.getComputedTextLength() + PAD; 
				var rectHeight = _fontSize + PAD;
				//var rectSize = { width: width, height: _fontSize };
				var arcRadius = FULL_RADIUS - EDGE;
				// given imaginary line between center of pie and middle angle of edge
				//   determine the furthest away point from center of pie such that the text rect is fully inside the slice
				var C = FULL_RADIUS; // 200
				var centerAngle = (angle + angle + angleLen) / 2;
				var centerAnglePoint = { x: getAngleX(centerAngle, arcRadius), y: getAngleY(centerAngle, arcRadius) };
				var rect = { x: centerAnglePoint.x - (rectWidth / 2), y: centerAnglePoint.y - (rectHeight / 2), width: rectWidth, height: rectHeight };

				var startX = rect.x;
				var startY = rect.y;
				var ccx = startX < 200 ? -1 : 1;
				var ccy = startY < 200 ? -1 : 1;
				var endX = C - (rectWidth / 2); //+ (centerAnglePoint.x - startX * ccx);
				var endY = C - (rectHeight / 2); //+ (centerAnglePoint.y - startY * ccy);

				// in this loop we work our way from edge of circle to center, in incremenetal units divisible by 100
				// if we get halfway there (50) and still the rect doesn't fit, then it will never fit
				for (var i=1; i<50; i++) {
					var curX = startX + (((endX - startX) / 100) * i);
					var curY = startY + (((endY - startY) / 100) * i);
					var curRect = { x: curX, y: curY, width: rect.width, height: rect.height };
					if (isRectInPath(curRect, path)) return curRect;
				}
				
				return null;
			}
			
			function isRectInPath(rect, path) {
				return Snap.path.isPointInside(path, rect.x, rect.y) && 
								Snap.path.isPointInside(path, rect.x + rect.width, rect.y) &&
								Snap.path.isPointInside(path, rect.x + rect.width, rect.y + rect.height) &&
								Snap.path.isPointInside(path, rect.x, rect.y + rect.height);
			}
			
			function generateSlicePath(startAngle, endAngle) {
				//M 340 251 L 300.142 399.753 A 154 154 0 0 1 231.106 359.894 L 340 251 A 0 0 0 0 0 340 251
				var path = "";
				var outerLength = FULL_RADIUS - EDGE;
				var startX = getAngleX(startAngle, outerLength);
				var startY = getAngleY(startAngle, outerLength);
				path += moveTo(startX, startY);
			
				path += generateSlicePathArc(startAngle, endAngle);
				var endX = getAngleX(endAngle, CENTER_SPACE);
				var endY = getAngleY(endAngle, CENTER_SPACE);
				path += lineTo(endX, endY);
				path += " Z";
			
				return path;
			}
		
			// startAngle: start angle (in degrees)
			// endAngle: end angle (in degrees)
			function generateSlicePathArc(startAngle, endAngle) {
				var arcRadius = FULL_RADIUS - EDGE;
				if (endAngle < startAngle) endAngle += 360;
				var angleDiff = endAngle - startAngle;
				var largeArc = angleDiff > 180 ? 1 : 0; // if greater than 180 deg we need to use large arc in path
				var endX = getAngleX(endAngle, arcRadius);
				var endY = getAngleY(endAngle, arcRadius);
				if (endX == 100 && pct > 0) endX = 99.999; // this corrects issue with path if start and end are same it won't draw an arc
				//debugger;
			
				// A 73,73 0 1,1 27,100
				var path = arcTo(arcRadius, largeArc, 1, endX, endY);
			
				return path;
			}
		
			function getAngleX(angle, fromCenter) {
				var rad = Snap.rad(angle);
				return (Math.sin(rad) * fromCenter) + FULL_RADIUS;
			}
		
			function getAngleY(angle, fromCenter) {
				var rad = Snap.rad(angle);
				return (-Math.cos(rad) * fromCenter) + FULL_RADIUS;
			}
		
			function lineTo(x, y) {
				return "L " + x + "," + y + " ";
			}
		
			function moveTo(x, y) {
				return "M " + x + "," + y + " ";
			}
		
			function arcTo(radius, largeArcFlag, sweepFlag, endX, endY) {
				return "A " + radius + "," + radius + " 0 " + largeArcFlag + "," + sweepFlag + " " + round3(endX) + "," + round3(endY) + " ";
			}
		
			function round3(val) {
				return parseInt(val * 1000) / 1000.0;
			}
			
			function slope(x1, x2, y1, y2) {
				if (x1 == x2) return NaN;
				return (y2 - y1) / (x2 - x1);
			}
		}
		
		Slice.prototype = {
		
			toPctString: function () {
				return (Math.round(this.ratio * 1000) / 10.0) + "%";
			},
			
			getLabelString: function(type) {
				// percentage|value|text
				type = type || _labelType;
				if (type == "value")
					return this.value + '';
				else if (type == "text")
					return this.label;
				else
					return this.toPctString();
			},
			
			centerAngle: function () {
				return (this.angle + this.angle + this.angleLength) / 2;
			}
		
		}
		
	
	  ]]>
	</script>
</svg></div>
</div>
<div class="col-2">
<div id="wb_Text2">
<span style="color:#F5F5DC;font-family:Arial;font-size:16px;"><strong>Average User Score</strong></span>
</div>
<div id="Html2" style="display:inline-block;width:100%;height:327px;z-index:9">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svidget="http://www.svidget.org/svidget" width="100%" height="100%" viewBox="0 0 400 400" style="background:transparent" svidget:version="0.3.0">
	<title>Donut Chart</title>
	<desc>
		A donut chart.
		This donut chart takes in an array of data elements and displays them as a donut.
		This widget was developed by Joe Agster for svidget.com and is licensed under the Creative Commons Attribution 4.0 License.
	</desc>

	<svidget:params>
		<!-- data params -->
		<svidget:param name="data" shortname="d" type="array" coerce="true" group="data" description="An array of name, value arrays. Example: [['Steelers', 0.14], ['Broncos', 0.38], ['Colts', 0.21], ['Raiders', 0.06]]. Note that the values do not need to sum to 1 or 100. The widget will auto sum the values to construct percentages." onset="handleDataParamSet"/>
		<svidget:param name="maxSlices" shortname="max" type="number" subtype="integer" coerce="true" group="data" description="The max number of slices to allow. If there are more data for slices, the lowest valued slices will be grouped together as one slice. Default is unlimited." onset="handleDataParamSet"/>
		<svidget:param name="startAngle" shortname="angle" type="number" coerce="true" defvalue="0" group="data" description="The angle (in degrees) where the first slice will be located." onset="handleDataParamSet"/>
		<svidget:param name="sort" shortname="sort" type="string" subtype="choice" typedata="none|asc|desc" coerce="true" group="data" defvalue="none" description="Whether to sort the data. When true sorted by greatet to least value." onset="handleDataParamSet"/>
		<!-- style params -->
		<svidget:param name="colors" shortname="c" type="array" coerce="true" group="appearance" description="An array of colors that correspond to each pie slice. If there are more slices than colors then colors will be reused." onset="handleDataParamSet"/>
		<svidget:param name="width" shortname="w" type="number" group="appearance" description="The width of the donut slice." onset="handleDataParamSet"/>
		<svidget:param name="labelStyle" shortname="lblstl" type="object" coerce="true" group="appearance" description="The style object for the label. Example { fontFamily: 'Arial', fontSize: '12px' }" onset="handleDataParamSet"/>
		<svidget:param name="labelType" shortname="lbltyp" type="string" subtype="choice" typedata="none|percentage|value|text" coerce="true" defvalue="percentage" group="appearance" description="The label value to display. Values are 'percentage', 'value', or 'text'. Default is text." onset="handleDataParamSet"/>
		<svidget:param name="innerLabelStyle" shortname="ilblstl" type="object" coerce="true" group="appearance" description="The style object for the label. Example { fontFamily: 'Arial', fontSize: '12px' }" onset="handleDataParamSet"/>
		<svidget:param name="innerLabelType" shortname="ilbltyp" type="string" subtype="choice" typedata="none|percentage|value|text" coerce="true" defvalue="text" group="appearance" description="The label value to display. Values are 'percentage', 'value', or 'text'. Default is text." onset="handleDataParamSet"/>
		<svidget:param name="popupStyle" shortname="popstl" type="object" coerce="true" group="appearance" description="The style object for the popup. Example { backgroundColor: '#dfdfdf', fontFamily: 'Arial', fontSize: '12px' }" onset="handlePopupParamSet"/>
		<svidget:param name="showPopup" shortname="sp" type="bool" coerce="true" defvalue="true" group="appearance" description="Whether to show the popup when hovering or clicking on donut slices." onset="handlePopupParamSet"/>
		<svidget:param name="showAnimation" shortname="sa" type="bool" coerce="true" defvalue="true" group="appearance" description="Whether to show animation." onset="handleUpdateParamSet"/>
	</svidget:params>

	<svidget:actions>
		<svidget:action name="animate" binding="animate" description="Animates the transition from 0-360 on the chart.">
			<svidget:actionparam name="duration" type="number" defvalue="0.5"/>
		</svidget:action>
	</svidget:actions>

	<svidget:events>
		<svidget:event name="sliceSelect" description="Triggered when a slice is selected either by mousing over or touching (on non-mouse devices)."/>
		<svidget:event name="sliceActivate" description="Triggered when a slice is activated due to a click or touch after slice was selected."/>
	</svidget:events>

	
	<defs>
		<clipPath id="popupboxclip">
			<rect x="0" y="0" width="120" height="50" stroke-width="2"/>
		</clipPath>
	</defs>

	<g>
		<text id="footer" font-size="10" font-family="Helvetica" x="395" y="395" fill="#7f7f7f" text-anchor="end">
			<a xlink:href="http://www.svidget.com" class="footer">Powered by Svidget.js</a>.
		</text>
	</g>

	<g id="test" transform="translate(-1000 -1000)">
		<text id="testtext" font-size="15" font-family="Helvetica" x="0" y="0"/>
	</g>

	<g id="chart" transform="translate(200 200)">
		
		
		
		
		
	<g class="slice" transform="rotate(0)"><path stroke="#fff" stroke-width="2" d="M1.1634144591899855e-14,-190A190,190 0 0,1 172.8300791173585,-78.92885247035841L118.2521593960874,-54.00395169024523A130,130 0 0,0 7.960204194457796e-15,-130Z" style="fill: rgb(164, 17, 238);"/><text dy=".35em" style="text-anchor: middle; font-family: Helvetica; font-size: 15px; fill: rgb(255, 255, 255);" transform="translate(86.50253079289563,-134.60056525298899)">18.2%</text><text dy=".35em" style="text-anchor: middle; font-family: Helvetica; font-size: 15px; fill: rgb(63, 63, 63);" transform="translate(56.22664501538216,-87.49036741444283)">100%</text></g><g class="slice" transform="rotate(0)"><path stroke="#fff" stroke-width="2" d="M172.8300791173585,-78.92885247035841A190,190 0 0,1 53.52918579987163,182.3036649867545L36.62523238938585,124.73408656988467A130,130 0 0,0 118.2521593960874,-54.00395169024523Z" style="fill: rgb(0, 217, 255);"/><text dy=".35em" style="text-anchor: middle; font-family: Helvetica; font-size: 15px; fill: rgb(255, 255, 255);" transform="translate(145.54111925672294,66.46640208030186)">27.3%</text><text dy=".35em" style="text-anchor: middle; font-family: Helvetica; font-size: 15px; fill: rgb(63, 63, 63);" transform="translate(94.6017275168699,43.203161352196204)"> 50%</text></g><g class="slice" transform="rotate(0)"><path stroke="#fff" stroke-width="2" d="M53.52918579987163,182.3036649867545A190,190 0 0,1 -188.06607395737723,-27.039819271924134L-128.67678744452127,-18.50092897552704A130,130 0 0,0 36.62523238938585,124.73408656988467Z" style="fill: rgb(80, 103, 255);"/><text dy=".35em" style="text-anchor: middle; font-family: Helvetica; font-size: 15px; fill: rgb(255, 255, 255);" transform="translate(-104.7777174312456,120.91993189668133)">31.8%</text><text dy=".35em" style="text-anchor: middle; font-family: Helvetica; font-size: 15px; fill: rgb(63, 63, 63);" transform="translate(-68.10551633030964,78.59795573284288)"> 75%</text></g><g class="slice" transform="rotate(0)"><path stroke="#fff" stroke-width="2" 
d="M-188.06607395737723,-27.039819271924134A190,190 0 0,1 -143.59241912730914,-124.42353944960408L-98.24744466605364,-85.131895412887A130,130 0 0,0 -128.67678744452127,-18.50092897552704Z" style="fill: rgb(0, 19, 194);"/><text dy=".35em" style="text-anchor: middle; font-family: Helvetica; font-size: 15px; fill: rgb(255, 255, 255);" transform="translate(-145.54111925672296,-66.46640208030178)">9.1%</text><text dy=".35em" style="text-anchor: middle; font-family: Helvetica; font-size: 15px; fill: rgb(63, 63, 63);" transform="translate(-94.60172751686993,-43.203161352196155)">25%</text></g><g class="slice" transform="rotate(0)"><path stroke="#fff" stroke-width="2" d="M-143.59241912730914,-124.42353944960408A190,190 0 0,1 -3.490243377569956e-14,-190L-2.3880612583373385e-14,-130A130,130 0 0,0 -98.24744466605364,-85.131895412887Z" style="fill: rgb(0, 189, 158);"/><text dy=".35em" style="text-anchor: middle; font-family: Helvetica; font-size: 15px; fill: rgb(255, 255, 255);" transform="translate(-66.46640208030195,-145.54111925672288)">13.6%</text><text dy=".35em" style="text-anchor: middle; font-family: Helvetica; font-size: 15px; fill: rgb(63, 63, 63);" transform="translate(-43.20316135219626,-94.60172751686987)">90%</text></g></g>

	<g id="popupbox" clip-path="url(#popupboxclip)" transform="translate(0 350)" display="none">
		<rect x="0" y="0" width="120" height="50" class="popupbox" stroke="#3f3f3f" stroke-width="2" style="fill: white;"/>
		<text id="popupboxlabel" font-weight="bold" stroke="none" stroke-width="0" text-anchor="start" x="5" y="20" style="font-family: Helvetica; font-size: 15px; fill: rgb(63, 63, 63);"> 75%</text>
		<text id="popupboxvalue" stroke="none" stroke-width="0" text-anchor="start" x="5" y="40" style="font-family: Helvetica; font-size: 15px; fill: rgb(63, 63, 63);">31.8% (7)</text>
	</g>

	<script type="application/javascript" xlink:href="../scripts/svidget.min.js"/>
	<script type="application/javascript" xlink:href="../scripts/d3.min.js"/>
	<script type="application/javascript">
		<![CDATA[
	
		// constants
		var DEFAULT_COLORS = ['#cf9f1f', '#1f9f1f', '#1f1fcf', '#9f1f9f', '#cf1f1f'];
		var STYLE_MAPPINGS = { backgroundColor: "fill", borderColor: "stroke", borderWidth: "stroke-width", color: "fill", fontFamily: "font-family", fontSize: "font-size", fontWeight: "font-weight", font]]><![CDATA[Style: "font-style", stroke: "stroke", strokeWidth: "stroke-width", strokeDashArray: "stroke-dasharray", textDecoration: "text-decoration" };
		var EDGE = 10; // space between pie and edge
		var SIZE = 400;
		var FULL_RADIUS = SIZE / 2;
		var CHART_RADIUS = FULL_RADIUS - EDGE;
		var ANIMATION_DURATION = 500; //ms
		var ANIMATION_EASING = "ease-in";
		
		// param variables
		var _data = [];
		var _maxSlices = 3;
		var _startAngle = 0;
		var _sort = 'none';
		var _colors = DEFAULT_COLORS;
		var _width = 80;
		var _labelStyle = null; //{ fontFamily: "Verdana", fontSize: "15px", color: "white", fontWeight: "bold" };
		var _labelType = 'percentage';
		var _innerLabelStyle = null;
		var _innerLabelType = 'text';
		var _popupStyle = null; //{ fontFamily: "Helvetica", backgroundColor: "#7fff7f", color: "red", fontSize: "15px", fontWeight: "normal", borderWidth: 0 };
		var _showPopup = true;
		var _showAnimation = true;

		// general variables
		var _loaded = false;
		var _runAnimation = true;
		var _arc = null;
		var _textArc = null;
		var _colorRange = null;
		var _dataSum = 0;
		var _selectedSliceIndex = null;
		
		/* Loading */
		
		// entry point
		function init() {
			//debugger;
			console.log('init');
			// for demo purposes only, in case no data is passed
			_data = [['banana', 4], ['apple', 6], ['cherry', 2], ['orange', 10], ['grape', 3.5]];
			initParams();
			initEvents();

			drawIfStandalone();
			_loaded = true;
		}
		
		function initParams() {
			loadParams();
		}
		
		function initEvents() {
			var surface = d3.select(document.documentElement);
			surface.on("click", handleSurfaceClick);
			var widget = svidget.$;
			widget.onpagepopulate(handlePagePopulate);
		}
		
		function drawIfStandalone() {
			// this is temp hack to give chance for page to pass params, if no page then we are in standalone mode
			d3.select("#chart").selectAll().remove();
			window.setTimeout(function () {
				if (svidget.$.populatedFromPage()) return;
				draw();
			}, 100);
		}
		
		window.addEventListener('load', init, false);
	
		
		/* Param Events */
		
		function loadParams() {
			var widget = svidget.$;
			_data = checkNull(widget.param("data").value(), _data);
			_maxSlices = checkNull(widget.param("maxSlices").value(), _maxSlices);
			_startAngle = checkNull(widget.param("startAngle").value(), _startAngle);
			_sort = checkNull(widget.param("sort").value(), _sort);
			_colors = checkNull(widget.param("colors").value(), _colors);
			_width = checkNull(widget.param("width").value(), _width);
			_labelStyle = checkNull(widget.param("labelStyle").value(), _labelStyle);
			_labelType = checkNull(widget.param("labelType").value(), _labelType);
			_innerLabelStyle = checkNull(widget.param("innerLabelStyle").value(), _innerLabelStyle);
			_innerLabelType = checkNull(widget.param("innerLabelType").value(), _innerLabelType);
			_popupStyle = checkNull(widget.param("popupStyle").value(), _popupStyle);
			_showPopup = checkNull(widget.param("showPopup").value(), _showPopup);
			_showAnimation = checkNull(widget.param("showAnimation").value(), _showAnimation);
		}
		
		// this handler is invoked once the params from page are passed to widget and populated onto params
		function handlePagePopulate(e) {
			loadParams();
			draw();
		}
		
		function handleUpdateParamSet(e) {
			if (!_loaded) return;
			//console.log('handleUpdateParamSet');
			var widget = svidget.$;
			if (widget.connected() && !widget.populatedFromPage()) return; // not all params have been populated, so defer until loadParams() is called
			//console.log('populated from page: ' + widget.populatedFromPage());
			_runAnimation = _runAnimation || e.target.name() == "data";
			loadParams();
		}
		
		// this handler is invoked when these params are set: data, maxSlices, startAngle, sort, fontSize, fontName, labelType
		function handleDataParamSet(e) {
			if (!_loaded) return;
			//console.log('handleDataParamSet');
			var widget = svidget.$;
			if (widget.connected() && !widget.populatedFromPage()) return; // not all params have been populated, so defer until loadParams() is called
			handleUpdateParamSet(e);
			drawChart();
		}
		
		// this handler is invoked when the showPopup params is set
		function handlePopupParamSet(e) {
			if (!_loaded) return;
			//console.log('handlePopupParamSet');
			var widget = svidget.$;
			if (widget.connected() && !widget.populatedFromPage()) return; // not all params have been populated, so defer until loadParams() is called
			_showPopup = widget.param("showPopup").value();
			if (!_showPopup) hidePopup(); // just in case
			drawPopup();
		}
		
		
		/* UI Events */
		
		function handleSliceOver(d, i) {
			//debugger;
			var de = d3.event;
			var chart = d3.select("#chart");
			var slice = d3.select(this);
			var slices = chart.selectAll(".slice");
			// clear previous hovers
			slices.classed("hover", false).classed("nonhover", true);
			// add hover to current slice
			slice.classed("nonhover", false).classed("hover", true);
			
			if (_showPopup) showPopup(d);
			if (_selectedSliceIndex != i) de.preventDefault(); // in case of touchstart, prevents "click" from firing (needs test)
			_selectedSliceIndex = i;
			
			// trigger svidget event
			var eventVal = toEventValue(d.data, _dataSum);
			svidget.$.event("sliceSelect").trigger(eventVal);
		}
		
		function handleSliceOut(d, i) {
			var de = d3.event;
			var chart = d3.select("#chart");
			var slices = chart.selectAll(".slice");
			// clear all hovers
			slices.classed("hover", false).classed("nonhover", false);

			hidePopup();
			_selectedSliceIndex = null;
		}
		
		function handleSliceClick(d, i) {
			var de = d3.event;
			_selectedSliceIndex = i;
			// trigger svidget event
			var eventVal = toEventValue(d.data, _dataSum);
			svidget.$.event("sliceActivate").trigger(eventVal);
			
			de.stopPropagation();
		}
		
		function handleSurfaceClick(d, i) {
			handleSliceOut(d, i);
		}
		
		
		/* Popup */
		
		function showPopup(d) {
			var data = d.data;
			var valueStr = toPctString(data[1], _dataSum) + " (" + data[1] + ")";
			var angle = toDegrees((d.endAngle + d.startAngle) / 2);
			d3.select("#popupboxlabel").text(data[0]);
			d3.select("#popupboxvalue").text(valueStr);
			var box = d3.select("#popupbox");
			var point = getCornerPosition(box, angle);
			box.attr("transform", translate(point.x, point.y));
			setVisible(box, true);
		}
		
		function hidePopup() {
			var box = d3.select("#popupbox");
			setVisible(box, false);
		}
		
		function getCornerPosition(box, angle) {
			var rect = box.select("rect").node();
			var w = rect.width.baseVal.value;
			var h = rect.height.baseVal.value;
			var x = 0;
			var y = 0;
			angle = angle % 360;
			if (angle <= 90)
				x = SIZE - w;
			else if (angle <= 180) {
				x = SIZE - w;
				y = SIZE - h;
			}
			else if (angle <= 270)
				y = SIZE - h;
			return { x: x, y: y };	
		}
		
		
		/* Action Handlers */
		
		function animate(e) {
			_runAnimation = true;
			reanimate();
		}
		
		
		/* Draw */
		
		function draw() {
			drawChart();
			drawPopup();
		}
		
		function reanimate() {
			var chart = d3.select("#chart");
			var slices = chart.selectAll(".slice");
			startAnimation(slices, _arc, _textArc);
		}
		
		function drawChart() {
			// see: http://bl.ocks.org/mbostock/3887193
			// also: http://datavizcatalogue.com/methods/donut_chart.html
			// debugger;
			var TEXT_RADIUS_RATIO = 0.6; // this is the ratio from the donut inner radius to center, to use for the text inside the donut
			var TEXT_MIN_RADIUS = 50;
			var outerRadius = CHART_RADIUS;
			var innerRadius = outerRadius - _width;
			var textInnerRadius = Math.min(innerRadius * TEXT_RADIUS_RATIO, innerRadius - TEXT_MIN_RADIUS);
			var data = maxifyData(_data, _maxSlices);
			
			// colors
			_colorRange = d3.scale.ordinal().range(_colors);

			// pie layout - for layout out arcs as a pie/donut chart
			var pie = d3.layout.pie()
				.startAngle(toRadians(_startAngle))
				.endAngle(toRadians(_startAngle + 360))
				.sort(sortDataFunc(_sort))
				.value(function(d) { 
					return numIt(d[1]); /* second element in data inner array */ 
				});
			
			// the main arc object
			_arc = d3.svg.arc()
				.outerRadius(outerRadius)
				.innerRadius(innerRadius);
			// the text arc object - for placing text inside of the donut
			_textArc = d3.svg.arc()
				.outerRadius(innerRadius)
				.innerRadius(textInnerRadius);
			
			// create chart and slices
			var chart = d3.select("#chart");
			chart.selectAll(".slice").remove(); // removes previous arcs
			var slices = chart.selectAll(".slice")
				//.remove() 
				.data(pie(data))
				.enter()
				.append("g");
			slices.attr("class", "slice hover");
			//g.attr("transform", translate(FULL_RADIUS, FULL_RADIUS));
			var paths = slices.append("path");
			// sum data for percentages
			_dataSum = getDataSum(data);
			
			// draw slices
			drawSlices(slices, paths, _arc, _colorRange);
			// draw labels
			drawLabels(slices, _arc, _textArc);
			// wire events
			wireEvents(slices);
			// animate
			startAnimation(slices, _arc, _textArc);
		}
		
		function drawSlices(slices, paths, arc, colorRange) {
			paths.attr("stroke", "#fff")
				.attr("stroke-width", 2)
				.attr("d", arc)
				.style("fill", function(d, i) { 
					return colorRange(i); 
				});
		}
		
		function drawLabels(slices, arc, textArc) {
			//debugger;
			// draw labels on arcs
			drawArcLabels(slices, arc, _labelType, copyObject(_labelStyle, getDefaultLabelStyle()), _dataSum);
			// draw labels in donut
			drawArcLabels(slices, textArc, _innerLabelType, copyObject(_innerLabelStyle, getDefaultInnerLabelStyle()), _dataSum);
		}
		
		function drawArcLabels(slices, arc, labelType, labelStyle, dataSum) {
			if (labelType == "none") return;
			slices.append("text")
				.attr("dy", ".35em")
				.attr("style", "")
				.style("text-anchor", "middle")
				.style(toSvgStyleObject(labelStyle))
				.attr("transform", function(d) { 
					//console.log('arc centroid: ' + arc.centroid(d));
					return "translate(" + arc.centroid(d) + ")"; 
				})
				.text(function(d) { 
					//console.log(d.data[0]);
					return getLabelString(d.data, labelType, dataSum); 
				});
		}
		
		function drawPopup() {
			//if (_popupStyle == null) return;
			var popupStyle = copyObject(_popupStyle, getDefaultPopupStyle());
			var styleObjs = separatePopupStyleObject(popupStyle);
			var popup = d3.select("#popupbox");
			// rect
			var rectStyle = toSvgStyleObject(styleObjs.rectStyle);
			var rect = popup.select("rect");
			rect.style(rectStyle);
			// text elements
			var textStyle = toSvgStyleObject(styleObjs.textStyle);
			var texts = popup.selectAll("text");
			texts.style(textStyle);
		}
		
		function wireEvents(slices) {
			//slices.data("index", slice.index);
			slices.on("mouseover", handleSliceOver);
			slices.on("touchstart", handleSliceOver); // for touch devices
			slices.on("mouseout", handleSliceOut);
			slices.on("click", handleSliceClick);
		}
		
		function startAnimation(slices, arc, textArc) {
			if (!_runAnimation || !_showAnimation) return;
			// console.log("starting animation");
			// move all slices to starting position
			slices.attr("transform", function(d) { 
				var rotate = "rotate(-" + toDegrees(arc.startAngle()(d)) + ")";
				//console.log(rotate);
				return rotate; 
			});
			slices.transition()
				.duration(ANIMATION_DURATION)
				.ease(ANIMATION_EASING)
				//.each("end", doneFunc) // we may need this later
				.attrTween("transform", tween);
			
			// tween function: rotates from start angle to its current angle position
			function tween(d, i, a) {
				var startRotate = "rotate(-" + toDegrees(arc.startAngle()(d)) + ")";
				var endRotate = "rotate(0)";
				return d3.interpolateString(startRotate, endRotate);
			}
			
			_runAnimation = false; // only run once unless invoked again by action
		}
		
		
		/* Data Helpers */
		
		function sortDataFunc(sort) {
			if (sort == null || sort == "none") return null;
			debugger;
			var asc = (sort == "asc");
			// a compare function to sort data in desc order by value
			function dataComparator(a, b) {
				var neg = asc ? 1 : -1;
				return (a[1] - b[1]) * neg; //sort descending by value (index 1 in subarray)
			}
			return dataComparator;
		}
		
		function getDefaultLabelStyle() {
			return { fontFamily: "Helvetica", fontSize: "15px", color: "#fff" };
		}
		
		function getDefaultInnerLabelStyle() {
			return { fontFamily: "Helvetica", fontSize: "15px", color: "#3f3f3f" };
		}
		
		function getDefaultPopupStyle() {
			return { fontFamily: "Helvetica", fontSize: "15px", color: "#3f3f3f" };
		}
		
		// gets label string: either text, value, or percentage
		function getLabelString(item, type, sum) {
			// item = ['label', value]
			// percentage|value|text
			type = type || _labelType;
			if (item == null || !item.length || item.length < 2) return "";
			if (type == "value")
				return item[1] + '';
			else if (type == "text")
				return item[0];
			else
				return toPctString(item[1], sum);
		}
		
		// returns { rectStyle: {...}, textStyle: {...} }
		function separatePopupStyleObject(styleObj) {
			// segment for rect vs group vs text objs
			// { backgroundColor: "fill", borderColor: "stroke", borderWidth: "stroke-width", color: "fill", fontFamily: "font-family", fontSize: "font-size", fontWeight: "font-weight", fontStyle: "font-style", stroke: "stroke", strokeWidth: "stroke-width", strokeDashArray: "stroke-dasharray", textDecoration: "text-decoration" };
			var rectObj = {};
			var textObj = {};
			for (var key in styleObj) {
				if (key.indexOf("background") == 0 || key.indexOf("border") == 0 || key.indexOf("stroke") == 0)
					rectObj[key] = styleObj[key];
				else
					textObj[key] = styleObj[key];
			}
			return { rectStyle: rectObj, textStyle: textObj };
		}
		
		function getDataSum(data) {
			var sum = 0;
			for (var i=0; i<data.length; i++) {
				sum += numIt(data[i][1]);
			}
			return sum;
		}
		
		function maxifyData(data, max) {
			//debugger;
			if (max == null || max <= 0 || max >= data.length) return data;
			var newdata = [];
			var count = 0;
			var restsum = 0;
			while (count < data.length) {
				if (count >= max - 1) {
					restsum += numIt(data[count][1]);
				}
				else {
					newdata.push(data[count]);
				}
				count++;
			}
			if (restsum > 0) newdata.push(["Other", restsum]);

			return newdata;
		}
		
		
		/* Misc */
		
		function checkNull(item, backupItem) {
			return item != null ? item : backupItem;
		}
		
		function numIt(val) {
			return nantoZero(parseFloat(val));
		}
		
		function nantoZero(val) {
			return isNaN(val) ? 0 : val;
		}
		
		function setVisible(ele, visible) {
			var d = visible ? "" : "none";
			ele.attr("display", d);
		}
		
		function translate(x, y) {
			return "translate(" + x + " " + y + ")";
		}

		function toSvgStyleObject(styleObj) {
			var snapObj = {};
			for (var key in styleObj) {
				var snapKey = STYLE_MAPPINGS[key];
				if (snapKey !== undefined) {
					snapObj[snapKey] = styleObj[key];
				}
			}
			return snapObj;
		}
		
		function copyObject(source, target) {
			if (source == null) return target;
			target = target || {};
			for (var key in source) {
				target[key] = source[key];
			}
			return target;
		}
		
		function toEventValue(data, ratio) {
			return { name: data[0], value: data[1], ratio: ratio };
		}
		
		function toPctString(value, sum) {
			value = numIt(value);
			var ratio = sum != 0 ? value / sum : 0;
			return (Math.round(ratio * 1000) / 10.0) + "%";
		}
		
		function toRadians(deg) {
			return (deg / 360) * Math.PI * 2;
		}
		
		function toDegrees(rad) {
			return (rad * 360) / (Math.PI * 2);
		}

	  ]]>
	</script>
</svg></div>
</div>
<div class="col-3">
<div id="wb_Text3">
<span style="color:#F5F5DC;font-family:Arial;font-size:16px;"><strong>login info</strong></span>
</div>
<div id="wb_Login1" style="display:inline-block;width:100%;z-index:11;">
<form name="loginform" method="post" accept-charset="UTF-8" action="<?php echo basename(__FILE__); ?>" id="loginform">
<input type="hidden" name="form_name" value="loginform">
<table id="Login1">
<tr>
   <td class="header">Log In</td>
</tr>
<tr>
   <td class="label"><label for="username">User Name</label></td>
</tr>
<tr>
   <td class="row"><input class="input" name="username" type="text" id="username" value="<?php echo $username; ?>"></td>
</tr>
<tr>
   <td class="label"><label for="password">Password</label></td>
</tr>
<tr>
   <td class="row"><input class="input" name="password" type="password" id="password" value="<?php echo $password; ?>"></td>
</tr>
<tr>
   <td class="row"><input id="rememberme" type="checkbox" name="rememberme"><label for="rememberme">Remember me</label></td>
</tr>
<tr>
   <td style="text-align:center;vertical-align:bottom"><input class="button" type="submit" name="login" value="Log In" id="login"></td>
</tr>
</table>
</form>

</div>
<div id="wb_SocialLogin1" style="display:inline-block;width:100%;text-align:center;z-index:12;">
<a id="SocialLogin1" href="<?php echo basename(__FILE__); ?>?provider=Google">Login with google</a>
</div>
</div>
</div>
</div>
</div>
<div id="wb_LayoutGrid2">
<div id="LayoutGrid2">
<div class="row">
<div class="col-1">
<div id="FlexGrid1">
<div class="title">
</div>
<div class="title1">
<div id="wb_TextArt6" style="display:inline-block;width:223px;height:48px;z-index:13;position:relative;">
<img src="images/img0006.png" id="TextArt6" alt="LEADERBOARD" title="LEADERBOARD" width="223" height="48" style="width:223px;height:48px;">
</div>
</div>
<div class="Title">
<div id="wb_TextArt7" style="display:inline-block;width:223px;height:48px;z-index:14;position:relative;">
<img src="images/img0007.png" id="TextArt7" alt="SCORE" title="SCORE" width="223" height="48" style="width:223px;height:48px;">
</div>
</div>
<div class="user1">
<div id="wb_TextArt1" style="display:inline-block;width:215px;height:37px;z-index:15;position:relative;">
<a href="./mathan-m.html"><img src="images/img0005.png" id="TextArt1" alt="      Mathan Raj" title="      Mathan Raj" width="215" height="37" style="width:215px;height:37px;"></a>
</div>
</div>
<div class="user_a">
<div id="wb_Text4">
<span style="color:#FFFFFF;font-family:Arial;font-size:21px;">score</span>
</div>
</div>
<div class="score">
<div id="wb_Text9">
<span style="color:#FFFFFF;font-family:Arial;font-size:21px;">358 </span><span style="color:#FFFFFF;font-family:'Cambria Math';font-size:21px;">â©</span>
</div>
</div>
<div class="user2">
<div id="wb_TextArt2" style="display:inline-block;width:215px;height:30px;z-index:18;position:relative;">
<a href="./raTnesh.html"><img src="images/img0001.png" id="TextArt2" alt="Ratnesh" title="Ratnesh" width="215" height="30" style="width:215px;height:30px;"></a>
</div>
</div>
<div class="user_b">
<div id="wb_Text5">
<span style="color:#FFFFFF;font-family:Arial;font-size:21px;">Score</span>
</div>
</div>
<div class="score2">
<div id="wb_Text11">
<span style="color:#FFFFFF;font-family:Arial;font-size:21px;">340 </span><span style="color:#FFFFFF;font-family:'Cambria Math';font-size:21px;">â©</span>
</div>
</div>
<div class="user3">
<div id="wb_TextArt3" style="display:inline-block;width:215px;height:30px;z-index:21;position:relative;">
<a href="./shameem.html"><img src="images/img0002.png" id="TextArt3" alt="Shameem" title="Shameem" width="215" height="30" style="width:215px;height:30px;"></a>
</div>
</div>
<div class="user_c">
<div id="wb_Text6">
<span style="color:#FFFFFF;font-family:Arial;font-size:21px;">score</span>
</div>
</div>
<div class="score3">
<div id="wb_Text12">
<span style="color:#FFFFFF;font-family:Arial;font-size:21px;">300 </span><span style="color:#FFFFFF;font-family:'Cambria Math';font-size:21px;">â©</span>
</div>
</div>
<div class="user4">
<div id="wb_TextArt4" style="display:inline-block;width:215px;height:30px;z-index:24;position:relative;">
<a href="./sakthi.html"><img src="images/img0003.png" id="TextArt4" alt="Sakthi " title="Sakthi " width="215" height="30" style="width:215px;height:30px;"></a>
</div>
</div>
<div class="user_d">
<div id="wb_Text7">
<span style="color:#FFFFFF;font-family:Arial;font-size:21px;">Score</span>
</div>
</div>
<div class="score4">
<div id="wb_Text13">
<span style="color:#FFFFFF;font-family:Arial;font-size:21px;">286 </span><span style="color:#FFFFFF;font-family:'Cambria Math';font-size:21px;">â©</span>
</div>
</div>
<div class="user5">
<div id="wb_TextArt5" style="display:inline-block;width:215px;height:30px;z-index:27;position:relative;">
<a href="./lenin.html"><img src="images/img0004.png" id="TextArt5" alt="Lelnin" title="Lelnin" width="215" height="30" style="width:215px;height:30px;"></a>
</div>
</div>
<div class="user_e">
<div id="wb_Text8">
<span style="color:#FFFFFF;font-family:Arial;font-size:21px;">score</span>
</div>
</div>
<div class="score5">
<div id="wb_Text10">
<span style="color:#FFFFFF;font-family:Arial;font-size:21px;">275 </span><span style="color:#FFFFFF;font-family:'Cambria Math';font-size:21px;">â©</span>
</div>
</div>
</div>
</div>
<div class="col-2">
</div>
</div>
</div>
</div>
<div id="wb_waitForItTitle">
<div id="waitForItTitle">
<div class="row">
<div class="col-1">
<div id="wb_waitForItHeading1" style="display:inline-block;width:100%;z-index:48;">
<h1 id="waitForItHeading1">Wait for it...</h1>
</div>
<div id="wb_waitForItHeading2" style="display:inline-block;width:100%;z-index:49;">
<h2 id="waitForItHeading2">Our website is coming soon!</h2>
</div>
</div>
</div>
</div>
</div>
<div id="wb_waitForIt">
<div id="waitForIt">
<div class="row">
<div class="col-1">
</div>
<div class="col-2">
<div id="wb_waitForItDays" style="display:inline-block;width:100%;z-index:50;">
<h2 id="waitForItDays">0</h2>
</div>
<div id="wb_waitForItText1">
<span style="color:#FFFFFF;font-family:Arial;font-size:16px;"><strong>DAYS</strong></span>
</div>
</div>
<div class="col-3">
<div id="wb_waitForItHours" style="display:inline-block;width:100%;z-index:52;">
<h2 id="waitForItHours">0</h2>
</div>
<div id="wb_waitForItText2">
<span style="color:#FFFFFF;font-family:Arial;font-size:16px;"><strong>HOURS</strong></span>
</div>
</div>
<div class="col-4">
<div id="wb_waitForItMinutes" style="display:inline-block;width:100%;z-index:54;">
<h2 id="waitForItMinutes">0</h2>
</div>
<div id="wb_waitForItText3">
<span style="color:#FFFFFF;font-family:Arial;font-size:16px;"><strong>MINUTES</strong></span>
</div>
</div>
<div class="col-5">
<div id="wb_waitForItSeconds" style="display:inline-block;width:100%;z-index:56;">
<h2 id="waitForItSeconds">0</h2>
</div>
<div id="wb_waitForItText4">
<span style="color:#FFFFFF;font-family:Arial;font-size:16px;"><strong>SECONDS</strong></span>
</div>
</div>
<div class="col-6">

</div>
</div>
</div>
</div>
</body>
</html>